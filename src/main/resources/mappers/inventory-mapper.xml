<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.semi.mappers.InventoryMapper">
    <resultMap id="inventoryResult" type="Inventory">
        <result column="STORAGE_NO" property="storageNo"/>
        <result column="PRODUCT_NO" property="productNo"/>
        <result column="QUANTITY" property="quantity"/>
        <result column="STOCK_IN_DATE" property="stockInDate"/>
        <result column="STOCK_OUT_DATE" property="stockOutDate"/>
        <result column="STORAGE_LOCATION" property="storageLocation"/>
        <result column="PRODUCT_NAME" property="productName"/>
        <result column="CATEGORY_NAME" property="categoryName"/>
        <result column="COLOR" property="color"/>
        <result column="PRODUCT_SIZE" property="productSize"/>
    </resultMap>
    <select id="getInventoryList" parameterType="Inventory" resultMap="inventoryResult">
        SELECT
        S.STORAGE_LOCATION,
        P.PRODUCT_NO,
        P.PRODUCT_NAME,
        C.CATEGORY_NAME,
        P.COLOR,
        P.PRODUCT_SIZE,
        I.QUANTITY
        FROM INVENTORY I
        JOIN STORAGE S ON I.STORAGE_NO = S.STORAGE_NO
        JOIN PRODUCT P ON I.PRODUCT_NO = P.PRODUCT_NO
        JOIN CATEGORY C ON P.CATEGORY_NO = C.CATEGORY_NO
        ORDER BY P.PRODUCT_NO ASC
    </select>
    <select id="searchInventoryList" parameterType="Inventory" resultMap="inventoryResult">
        SELECT
            S.STORAGE_LOCATION,
            P.PRODUCT_NO,
            P.PRODUCT_NAME,
            C.CATEGORY_NAME,
            P.COLOR,
            P.PRODUCT_SIZE,
            I.QUANTITY
        FROM INVENTORY I
        JOIN STORAGE S ON I.STORAGE_NO = S.STORAGE_NO
        JOIN PRODUCT P ON I.PRODUCT_NO = P.PRODUCT_NO
        JOIN CATEGORY C ON P.CATEGORY_NO = C.CATEGORY_NO
        <where>
            <if test="storageNo != null">
                AND I.STORAGE_NO = #{storageNo}
            </if>
            <if test="keyword != null and keyword !=''">
                AND LOWER(P.PRODUCT_NAME) LIKE '%' || #{keyword} || '%'
            </if>
        </where>
        ORDER BY P.PRODUCT_NO ASC
    </select>
</mapper>