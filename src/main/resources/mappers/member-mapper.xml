<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.semi.mappers.MemberMapper">
    <resultMap id="memberResult" type="Member">
        <result column="EMP_NO" property="empNo"/>
        <result column="STORE_ID" property="storeId"/>
        <result column="STORE_NAME" property="storeName"/>
        <result column="MEM_ID" property="memId"/>
        <result column="MEM_PWD" property="memPwd"/>
        <result column="MEM_NAME" property="memName"/>
        <result column="PHONE" property="phone"/>
        <result column="POSITION" property="position"/>
        <result column="STATUS" property="status"/>
        <result column="CREATE_DATE" property="createDate"/>
        <result column="MODIFY_DATE" property="modifyDate"/>
        <result column="HIRE_DATE" property="hireDate"/>
        <result column="SALARY" property="salary"/>
    </resultMap>
    <select id="loginMember" parameterType="Member" resultMap="memberResult">
        SELECT
        EMP_NO,
        STORE_ID,
        MEM_ID,
        MEM_PWD,
        MEM_NAME,
        PHONE,
        POSITION,
        STATUS,
        CREATE_DATE,
        MODIFY_DATE,
        HIRE_DATE,
        SALARY
        FROM MEMBER
        WHERE MEM_ID = #{memId}
        AND MEM_PWD = #{memPwd}
    </select>

    <insert id="insertMember" parameterType="Member">
        INSERT INTO MEMBER (
        EMP_NO,
        MEM_ID,
        MEM_PWD,
        MEM_NAME,
        PHONE
        )
        VALUES (
        EMP_NO.NEXTVAL,
        #{memId},
        #{memPwd},
        #{memName},
        #{phone}
        )
    </insert>

    <select id="checkId" resultType="_int">
        SELECT COUNT(*)
        FROM MEMBER
        WHERE MEM_ID = #{memId}
    </select>

    <select id="selectMemberList" resultMap="memberResult">
        SELECT M.EMP_NO,
        M.HIRE_DATE,
        M.MEM_NAME,
        S.STORE_NAME,
        M.POSITION,
        M.PHONE,
        M.SALARY
        FROM MEMBER M
        JOIN STORE S ON M.STORE_ID = S.STORE_ID
        WHERE M.STATUS = 'Y'
        ORDER BY M.EMP_NO ASC
    </select>

    <select id="acceptMemberList" resultMap="memberResult">
        SELECT
        EMP_NO,
        STORE_ID,
        MEM_ID,
        MEM_PWD,
        MEM_NAME,
        PHONE,
        POSITION,
        STATUS,
        CREATE_DATE,
        MODIFY_DATE,
        HIRE_DATE,
        SALARY
        FROM MEMBER
        WHERE STATUS = 'N'
        ORDER BY EMP_NO ASC
    </select>

    <update id="approveMember">
        UPDATE MEMBER M
        SET M.STATUS = 'Y',
            M.POSITION = 'employee',
            M.STORE_ID = (SELECT S.STORE_ID
                          FROM STORE S
                          WHERE S.STORE_NAME = #{storeSelect})
        WHERE M.MEM_ID =#{memId}
    </update>

    <update id="rejectMember">
        UPDATE MEMBER
        SET STATUS = 'D'
        WHERE MEM_ID = #{memId}
    </update>

</mapper>